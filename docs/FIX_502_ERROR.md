# 502 Bad Gateway 에러 해결 가이드

## 🔴 현재 문제

콘솔에 다음 에러가 표시됩니다:
- `502 Bad Gateway` - 백엔드 서버가 응답하지 않음
- `CORS policy: No 'Access-Control-Allow-Origin' header` - 서버가 응답하지 않아 CORS 헤더를 보낼 수 없음

## 🔍 원인 분석

502 Bad Gateway 에러는 다음을 의미합니다:
1. **백엔드 서버가 다운되었거나 실행되지 않음**
2. **서버가 시작 중이거나 재시작 중**
3. **서버 시작 시 에러가 발생하여 크래시됨**
4. **환경 변수 설정 오류로 인한 서버 시작 실패**

## ✅ 해결 방법

### 1단계: Render 대시보드에서 서버 상태 확인

1. **Render 대시보드 접속**
   - 백엔드 서비스 페이지로 이동

2. **서비스 상태 확인**
   - 서비스가 "Live" 상태인지 확인
   - "Building" 또는 "Deploying" 상태라면 완료 대기

3. **최근 배포 확인**
   - 최근 배포가 성공했는지 확인
   - 실패했다면 에러 메시지 확인

### 2단계: 서버 로그 확인

1. **Logs 탭 클릭**
   - Render 대시보드에서 "Logs" 탭 확인

2. **에러 메시지 확인**
   - 서버 시작 실패 에러 확인
   - 데이터베이스 연결 에러 확인
   - 환경 변수 관련 에러 확인

3. **주요 확인 사항**
   - `서버가 포트 ${PORT}에서 실행 중입니다.` 메시지가 있는지
   - 데이터베이스 연결 에러가 있는지
   - `time_pattern` 컬럼 관련 에러가 있는지

### 3단계: 환경 변수 확인

Render 대시보드에서 다음 환경 변수가 올바르게 설정되어 있는지 확인:

1. **DATABASE_URL**
   - PostgreSQL 데이터베이스 연결 URL
   - 형식: `postgresql://user:password@host:port/database?sslmode=require`

2. **CORS_ORIGIN**
   - 프론트엔드 URL
   - 형식: `https://order-app-frontend-76rp.onrender.com`
   - 여러 URL은 쉼표로 구분

3. **PORT**
   - Render가 자동으로 설정 (보통 설정 불필요)

### 4단계: 서버 재시작

1. **수동 재배포**
   - Render 대시보드에서 "Manual Deploy" → "Deploy latest commit" 클릭

2. **또는 환경 변수 수정 후 자동 재배포**
   - 환경 변수 수정 시 자동으로 재배포됨

### 5단계: 코드 확인

서버가 시작되지 않는 경우, 다음을 확인:

1. **데이터베이스 연결**
   - `DATABASE_URL`이 올바른지 확인
   - 데이터베이스가 실행 중인지 확인

2. **서버 시작 코드**
   - `server.js`에서 에러가 발생하지 않는지 확인
   - `ensureTimePatternColumn()` 함수가 에러를 발생시키지 않는지 확인

## 🔧 임시 해결 방법

서버가 계속 시작되지 않는다면:

1. **환경 변수 임시 제거**
   - 문제가 되는 환경 변수를 임시로 제거하고 재배포
   - 서버가 시작되는지 확인

2. **에러 핸들링 강화**
   - 서버 시작 시 에러가 발생해도 서버가 계속 실행되도록 수정

## 📝 체크리스트

- [ ] Render 대시보드에서 서비스 상태 확인
- [ ] Logs 탭에서 에러 메시지 확인
- [ ] DATABASE_URL 환경 변수 확인
- [ ] CORS_ORIGIN 환경 변수 확인
- [ ] 서버 재배포 시도
- [ ] 재배포 후 로그에서 "서버가 포트 ...에서 실행 중입니다." 메시지 확인

## 🚨 긴급 조치

서버가 계속 시작되지 않는다면:

1. **Render Shell 사용** (유료 기능)
   - 서버에 직접 접속하여 문제 확인

2. **로컬에서 테스트**
   - 로컬 환경에서 서버 실행 테스트
   - 문제 재현 및 해결

3. **에러 로그 공유**
   - Render 로그를 공유하면 더 정확한 진단 가능
