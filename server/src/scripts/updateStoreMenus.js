import pool from '../config/database.js';
import * as menuModel from '../models/menuModel.js';

// ì»¤í”¼ë¹ˆ í˜„ëŒ€ìžë™ì°¨ë‚¨ì–‘ì—°êµ¬ì†Œì ì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ íŒë§¤í•˜ëŠ” ê¸°ë³¸ ë©”ë‰´ ëª©ë¡
// ê¸°ì—…ì²´ ë§¤ìž¥ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ê¸°ë³¸ ë©”ë‰´ ìœ„ì£¼ë¡œ íŒë§¤
const STORE_MENUS = {
  // ì»¤í”¼ - ê¸°ë³¸ ë©”ë‰´
  active: [
    // ì—ìŠ¤í”„ë ˆì†Œ ìŒë£Œ
    'ì•„ë©”ë¦¬ì¹´ë…¸',
    'ì¹´íŽ˜ë¼ë–¼',
    'ì¹´íŽ˜ëª¨ì¹´',
    'ì¹´í‘¸ì¹˜ë…¸',
    'ì—ìŠ¤í”„ë ˆì†Œ',
    'ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸',
    'ì•„ì´ìŠ¤ ì¹´íŽ˜ëª¨ì¹´',
    'ì¹´ë¼ë©œ ë§ˆí‚¤ì•„í† ',
    'í—¤ì´ì¦ë„› ë¼ë–¼',
    'ë°”ë‹ë¼ ë¼ë–¼',
    'ì½œë“œë¸Œë£¨',
    
    // ë…¼ì»¤í”¼ - ê¸°ë³¸ ë©”ë‰´
    'ê·¸ë¦°í‹° ë¼ë–¼',
    'ì´ˆì½œë¦¿ ë¼ë–¼',
    'ì•„ì´ìŠ¤í‹°',
    'ë ˆëª¬ì—ì´ë“œ',
    'ìžëª½ì—ì´ë“œ',
    'ìœ ìžì°¨',
    
    // ë””ì €íŠ¸ - ê¸°ë³¸ ë©”ë‰´
    'ì¹˜ì¦ˆì¼€ì´í¬',
    'ì´ˆì½œë¦¿ ì¼€ì´í¬',
    'ë§ˆì¹´ë¡±',
    'ë¸Œë¼ìš°ë‹ˆ',
    'ë¨¸í•€',
    'ìŠ¤ì½˜',
  ],
  
  // Season offë¡œ ë³€ê²½í•  ë©”ë‰´ (íŠ¹ì • ì‹œì¦Œ ë©”ë‰´, ë³µìž¡í•œ ë©”ë‰´ ë“±)
  season_off: [
    // ì‹œì¦Œ í•œì • ë©”ë‰´
    'ì„¤í–¥ ë”¸ê¸° ë¼ë–¼',
    'ì„¤í–¥ ë”¸ê¸° ìš”ê±°íŠ¸ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'ì„¤í–¥ ë”¸ê¸° ì‚¬ê³¼ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'ë§ì°¨ í¬ë¦¼ ì„¤í–¥ ë”¸ê¸° ë¼ë–¼',
    'í“¨ì–´ ë“œë¦¼ í™”ì´íŠ¸ ë±…ì‡¼',
    'ì•„ì´ìŠ¤ í“¨ì–´ ë“œë¦¼ í™”ì´íŠ¸ ë±…ì‡¼',
    'ì•„ì´ìŠ¤ í“¨ì–´ ë“œë¦¼ í‹°',
    
    // ë³µìž¡í•œ ë©”ë‰´ë“¤
    'ë°”ë‹ë¼ë¹ˆ ì˜¤íŠ¸ë¼ë–¼',
    'ì•„ì´ìŠ¤ ë°”ë‹ë¼ë¹ˆ ì˜¤íŠ¸ë¼ë–¼',
    'ë°”ë‹ë¼ë¹ˆ ì˜¤íŠ¸ ì½œë“œë¸Œë£¨',
    'ë°”ë‹ë¼ ë¹ˆ í”Œëž« í™”ì´íŠ¸',
    'ì½œë“œë¸Œë£¨ ë¼ë–¼',
    'ì½œë“œë¸Œë£¨ ìˆ˜ì•„',
    'ë“œë¦½ì»¤í”¼',
    'ì•„ì´ìŠ¤ ë“œë¦½ì»¤í”¼',
    'ë§ˆë¼ì•„í† ë„¤',
    'ë¸Œë¼ìš´ ë§ˆë¼ì•„í† ë„¤',
    'ë§ì°¨ ëª¨ížˆí†  ìŠ¤íŒŒí´ë§',
    
    // í‹° ë¼ë–¼ ë° ë³µìž¡í•œ í‹° ë©”ë‰´
    'ì°¨ì´ ë¼ë–¼',
    'ì•„ì´ìŠ¤ ì°¨ì´ ë¼ë–¼',
    'ìž‰ê¸€ë¦¬ì‰¬ ë¸Œë ‰í¼ìŠ¤íŠ¸ ë¼ë–¼',
    'ì•„ì´ìŠ¤ ìž‰ê¸€ë¦¬ì‰¬ ë¸Œë ‰í¼ìŠ¤íŠ¸ ë¼ë–¼',
    'ë ˆëª¬ ë¯¼íŠ¸ í‹°',
    'ì•„ì´ìŠ¤ ë ˆëª¬ ë¯¼íŠ¸ í‹°',
    'ì•„ì´ìŠ¤ ì‚´êµ¬ ì‹¤ë¡ ',
    'ì•„ì´ìŠ¤ ì–¼ ê·¸ë ˆì´',
    'ì•„ì´ìŠ¤ ìž‰ê¸€ë¦¬ì‰¬ ë¸Œë ‰í¼ìŠ¤íŠ¸',
    'ì œì£¼ ë ˆëª¬ ìŠ¤ì›¨ë””ì‰¬',
    'ì•„ì´ìŠ¤ ì œì£¼ ìœ ê¸°ë† ìž‘ì„¤ì°¨',
    'ì•„ì´ìŠ¤ ê´‘ì–‘ ë§¤í™” ìžìŠ¤ë¯¼ í‹°',
    'ì•„ì´ìŠ¤ í•˜ë™ ë…¹ì°¨ ë¯¼íŠ¸ í‹°',
    'ì œì£¼ ì²«ë¬¼ ë§ì°¨ ë¼ë–¼ (R)',
    'ì•„ì´ìŠ¤ ì œì£¼ ì²«ë¬¼ ë§ì°¨ ë¼ë–¼ (R)',
    'í•˜ë™ ë…¹ì°¨ ë¯¼íŠ¸ ì´ˆì½œë¦¿ ë¼ë–¼',
    'ì•„ì´ìŠ¤ í•˜ë™ ë…¹ì°¨ ë¯¼íŠ¸ ì´ˆì½œë¦¿ ë¼ë–¼',
    
    // ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ
    'ë°”ë‹ë¼ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'ë² ë¦¬ë² ë¦¬ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'ì¹´íŽ˜ëª¨ì¹´ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'ìºëŸ¬ë©œ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'í—¤ì´ì¦ë„› ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'ê³ í¥ìœ ìž ìºëª¨ë§ˆì¼ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'ë§ê³  ë°”ë‚˜ë‚˜ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'í›„ë ˆì‰¬ ë§ê³  ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'ì œì£¼ ì²«ë¬¼ ë§ì°¨ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    'í“¨ì–´ ë”ë¸” ì´ˆì½œë¦¿ ì•„ì´ìŠ¤ ë¸”ë Œë””ë“œ',
    
    // ì£¼ìŠ¤ ë° ë³‘ìŒë£Œ
    'ê°ê·¤ë‹¹ê·¼ì£¼ìŠ¤',
    'ê·¸ë¦°ë°¸ëŸ°ìŠ¤',
    'ë” ê±´ê°•í•œ ìŠ¤íŠ¸ë¡œë² ë¦¬ ì£¼ìŠ¤',
    
    // ë³µìž¡í•œ ë””ì €íŠ¸ ë©”ë‰´
    'ê·¸ë¦´ë“œ ë¹„í”„ì¹˜ì¦ˆ ìƒŒë“œìœ„ì¹˜',
    'ëª¨ë‹ ë¹„í”„í•„ë¦¬ì¹˜ì¦ˆ ë²ˆ',
    'ì—ê·¸ ë² ì´ì»¨ ë¸Œë¦¬ì˜¤ìŠˆ',
    'í”¼ìž ì†Œì‹œì§€ ë¸Œë ˆë“œ',
    'ì¹˜í‚¨ & ì—ê·¸ ìƒëŸ¬ë“œ ëž©',
    'ì¼€ì´ì¤€ í†µì•ˆì‹¬ ìƒëŸ¬ë“œ ëž©',
    'BLT ì¹˜í‚¨ ìƒŒë“œìœ„ì¹˜',
    'ëª¨ì§œë ë¼ ì¹˜í´ë ˆì¹˜í‚¨ ìƒŒë“œìœ„ì¹˜',
    'ë² ì´ì»¨ íŒŒ í¬ë¦¼ì¹˜ì¦ˆ ë² ì´ê¸€',
    'ë°ë‹ˆì‰¬ íë¸Œì‹ë¹µ í”Œë ˆì¸',
    'í¬ëžœë² ë¦¬ í¬ë¦¼ì¹˜ì¦ˆ ìŠ¤ì½˜',
    'í¬ë¦¼ ì¹˜ì¦ˆ ë¨¸í•€',
    'í´ëž˜ì‹ ì´ˆì½” ë¨¸í•€',
    'í”Œë ˆì¸ ë²„í„° ìŠ¤ì½˜',
    'í¬ë¡œí¬ë¬´ìŠˆ',
    'ë§ëˆ ì†Œê¸ˆë¹µ',
    'í”Œë ˆì¸ ë² ì´ê¸€',
    'ìŒ€ ë¸”ë£¨ë² ë¦¬ ë² ì´ê¸€',
  ]
};

async function updateStoreMenus() {
  const client = await pool.connect();
  
  try {
    await client.query('BEGIN');
    
    console.log('='.repeat(80));
    console.log('ì»¤í”¼ë¹ˆ í˜„ëŒ€ìžë™ì°¨ë‚¨ì–‘ì—°êµ¬ì†Œì  ë©”ë‰´ ì—…ë°ì´íŠ¸');
    console.log('='.repeat(80));
    
    // ëª¨ë“  ë©”ë‰´ ì¡°íšŒ
    const allMenus = await pool.query('SELECT id, name FROM menus');
    
    let activeCount = 0;
    let seasonOffCount = 0;
    let notFoundCount = 0;
    
    console.log('\nðŸ“‹ ë©”ë‰´ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œìž‘...\n');
    
    for (const menu of allMenus.rows) {
      const menuName = menu.name;
      
      // Active ë©”ë‰´ ëª©ë¡ì— ìžˆëŠ”ì§€ í™•ì¸
      if (STORE_MENUS.active.includes(menuName)) {
        // Activeë¡œ ì„¤ì •
        await menuModel.updateMenu(menu.id, { sale_status: 'active' });
        console.log(`âœ… [Active] ${menuName}`);
        activeCount++;
      } 
      // Season off ë©”ë‰´ ëª©ë¡ì— ìžˆëŠ”ì§€ í™•ì¸
      else if (STORE_MENUS.season_off.includes(menuName)) {
        // Season offë¡œ ì„¤ì •
        await menuModel.updateMenu(menu.id, { sale_status: 'season_off' });
        console.log(`â¸ï¸  [Season Off] ${menuName}`);
        seasonOffCount++;
      } 
      // ëª©ë¡ì— ì—†ëŠ” ë©”ë‰´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ season_offë¡œ ì„¤ì • (ê¸°ì—…ì²´ ë§¤ìž¥ì—ì„œëŠ” íŒë§¤í•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±)
      else {
        await menuModel.updateMenu(menu.id, { sale_status: 'season_off' });
        console.log(`âš ï¸  [Season Off - ëª©ë¡ ì—†ìŒ] ${menuName}`);
        notFoundCount++;
      }
    }
    
    await client.query('COMMIT');
    
    console.log('\n' + '='.repeat(80));
    console.log('ì—…ë°ì´íŠ¸ ì™„ë£Œ');
    console.log(`  âœ… Active ë©”ë‰´: ${activeCount}ê°œ`);
    console.log(`  â¸ï¸  Season Off ë©”ë‰´: ${seasonOffCount + notFoundCount}ê°œ`);
    console.log(`     - ëª©ë¡ì— ëª…ì‹œëœ Season Off: ${seasonOffCount}ê°œ`);
    console.log(`     - ëª©ë¡ì— ì—†ëŠ” ë©”ë‰´ (Season Off ì²˜ë¦¬): ${notFoundCount}ê°œ`);
    console.log('='.repeat(80));
    console.log('\nðŸ’¡ ì°¸ê³ : ê¸°ì—…ì²´ ë§¤ìž¥ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ê¸°ë³¸ ë©”ë‰´ë§Œ íŒë§¤í•©ë‹ˆë‹¤.');
    console.log('   í•„ìš”ì‹œ ë©”ë‰´ ê´€ë¦¬ í™”ë©´ì—ì„œ ì¶”ê°€ ë©”ë‰´ë¥¼ í™œì„±í™”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.\n');
    
  } catch (error) {
    await client.query('ROLLBACK');
    console.error('âŒ ë©”ë‰´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
    throw error;
  } finally {
    client.release();
  }
}

updateStoreMenus()
  .then(() => {
    process.exit(0);
  })
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
